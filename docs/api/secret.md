---
layout: wmt/docs
title:  Secret
side-navigation: wmt/docs-navigation.html
---

# {{ page.title }}

A secret is either a username/password or name/ssh-key pair that is used to 
access repositories and other systems.

The REST API provides support for a number of operations:

- [Create a Secret](#create-secret)
- [Examples](#examples)
- [Get Secret's Metadata](#get-secret-metadata)
- [Get Public SSH Key of Secret](#get-key)
- [Delete a Secret](#delete-secret)
- [List Secrets](#list-secrets)


<a name="create-secret"/>
## Create a Secret

Creates a new secret.

* **URI** `/api/v1/org/${orgName}/secret`
* **Method** `POST`
* **Headers** `Authorization`, `Content-Type: multipart/form-data`
* **Multipart request**
    - `type` - mandatory, supported types:
      - `key_pair` - a SSH key pair, public and private key files;
      - `username_password` - a pair of string values;
      - `data` - binary or text data.
    - `name` - mandatory, the name of the created secret. Must be
    unique for the organization;
    - `storePassword` - optional, a password, will be used to encrypt
    the created secret and which can be used to retrieve it back;
    - `generatePassword` - optional, a boolean value. If `true`, the
    server will automatically generate and return a `storePassword`
    value;
    - `visibility` - optional, `PUBLIC` (default) or `PRIVATE`. See
    the description of [public and private resources](../getting-started/orgs.html);
    
    The rest of the parameters depend of the `type` of the created
    secret:
    - `type=key_pair`:
        - `public` - a public key file of the key pair;
        - `private` - a private key file of the key pair.
    - `type=username_password`:
        - `username` - a string value;
        - `password` - a string value.
    - `type=data`:
        - `data` - a string or binary value.
        
    For `type=key_pair` if a `public` value is omitted, a new key
    pair will generated by the server. 
* **Success response**
    ```
    Content-Type: application/json
    ```

    ```json
    {
      "id": "...",
      "result": "CREATED",
      "ok": true
    }
    ```

<a name="examples"/>
## Examples

### Generate a new Key Pair

On a default installation you can perform this step with the default `admin`
user and it's authorization token:

```
curl -H "Authorization: auBy4eDWrKWsyhiDp3AQiw" \
-F name=myKey \
-F type=key_pair \
https://concord.example.com/api/v1/org/Default/secret
```

The server will generate a new key pair and return the public key:

```
{
  "id" : "e7c24546-e0e1-11e7-be9f-fa163e0708eb",
  "result" : "CREATED",
  "publicKey" : "ssh-rsa AAAAB3NzaC1...zri1 concord-server\n",
  "ok" : true
}
```

### Upload an Existing Key Pair

On a default installation you can perform this step with the default `admin`
user and it's authorization token:

```
curl -H "Authorization: auBy4eDWrKWsyhiDp3AQiw" \
-F name=myKey \
-F type=key_pair \
-F public=@/path/to/id_rsa.pub \
-F private=@/path/to/id_rsa \
https://concord.example.com/api/v1/org/Default/secret
```

### Creating a Username and Password Secret

On a default installation you can perform this step with the default `admin`
user and it's authorization token:

```
curl -H "Authorization: auBy4eDWrKWsyhiDp3AQiw" \
-F name=myKey \
-F type=username_password \
-F username=myUser \
-F password=myPass \
https://concord.example.com/api/v1/org/Default/secret
```

### Storing a Single Value

On a default installation you can perform this step with the default `admin`
user and it's authorization token:

```
curl -H "Authorization: auBy4eDWrKWsyhiDp3AQiw" \
-F name=myKey \
-F type=data \
-F data=myValue \
https://concord.example.com/api/v1/org/Default/secret
```
    
<a name="get-secret-metadata>
## Get Secret's Metadata

Retrieves metadata of an existing secret.

* **URI** `/api/v1/org/${orgName}/secret/${secretName}`
* **Method** `GET`
* **Headers** `Authorization`
* **Body**
    none
* **Success response**
    ```
    Content-Type: application/json
    ```

    ```json
    {
      "id": "...",
      "name": "secretName",
      "orgId": "...",
      "orgName": "...",
      "type": "...",
      "storeType": "...",
      "visibility": "..."
    }
    ```

<a name="get-key"/>
## Get Public SSH Key of Secret

Returns a public key from an existing key pair of a secret.

* **URI** `/api/v1/org/${orgName}/secret/${secretName}/public`
* **Method** `GET`
* **Headers** `Authorization`
* **Body**
    none
* **Success response**
    ```
    Content-Type: application/json
    ```

    ```json
    {
      "name": "secretName",
      "publicKey": "ssh-rsa AAAA... concord-server",
      "ok": true
    }
    ```

Examples:

On a default installation you can access a key with the default `admin` user and it's authorization token:

```
curl -H "Authorization: auBy4eDWrKWsyhiDp3AQiw" 'https://concord.example.com/api/v1/org/Default/secret/myKey/public'
```

On a typical production installation you can pass your username and be quoted
for the password:

```
curl -u username 'https://concord.example.com/api/v1/org/Default/secret/myKey/public'
```

The server provides a JSON-formatted response similar to:
 
```json
{
  "name" : "myKey",
  "publicKey" : "ssh-rsa ABCXYZ... concord-server",
  "ok" : true
}
```

The value of the `publicKey` attribute represents the public key of the newly
generated key.

The value of the `name` attribute e.g. `myKey` identifies the key for
usage in Concord.

<a name="delete-secret"/>
## Delete a Secret

Deletes a secret and associated keys.

* **URI** `/api/v1/org/${orgName}/secret/${secretName}`
* **Method** `DELETE`
* **Headers** `Authorization`
* **Body**
    none
* **Success response**
    ```
    Content-Type: application/json
    ```

    ```json
    {
      "ok": true
    }
    ```

<a name="list-secrets"/>
## List Secrets

Lists existing secrets.

* **Permissions**
* **URI** `/api/v1/org/${orgName}/secret`
* **Method** `GET`
* **Body**
    none
* **Success response**
    ```
    Content-Type: application/json
    ```

    ```json
    [
      { "name": "...", "type": "..." },
      { "name": "...", "type": "..." }
    ]
    ```
