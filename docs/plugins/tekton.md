---
layout: wmt/docs
title:  Tekton Task
side-navigation: wmt/docs-navigation.html
---

# {{ page.title }}

Concord supports interaction with Tekton with the `tekton` task as part of any
flow. 

- [Usage](#usage)
- [Parameters](#parameters)

## Usage

To be able to use the task in a Concord flow, it must be added as a
[dependency](../getting-started/concord-dsl.html#dependencies):

```yaml
configuration:
  dependencies:
  - mvn://com.walmartlabs.concord.plugins:tekton-task:{{ site.concord_plugins_version }}
```

This adds the task to the classpath and allows you to invoke the task in a flow.
There are many possible operations in tekton, and here are example flows for each of them. We also provide complete examples, along with example operational forms [here](https://gecgithub01.walmart.com/devtools/tekton-examples)

### Provisioning
To provision new VMs, you first need a [template](#compute) for the VMs you want to provision. This file can, via the `templatePath` parameter, can exist anywhere in your project. The default location is at `compute.yml`. Once you have your template, you can invoke the provisioner like so

```yaml
flows:
  default:
  - task: tekton
    in:
      action: provision
      envName: dev
      ```yaml
      # the following is only required if you have a custom template path
      templatePath: "templates/dev.yml"
```
Provisioning results are printed to the process log, and also available via the variable `addresses`.



## Templates
### Compute
A compute template tells Tekton what VMs to deploy where, and how many you would like. They are written in YAML format. This is an example of one
```yaml
clouds:
  cdc:
    - zone: cdc14
      computes: 2
      primary: true
      deploymentOrder: 0
  dfw:
    - zone: dfw14
      computes: 2
      primary: true
      deploymentOrder: 1
compute:
  entity: walmartlabs
  name: test
  type: small
  image: centos-7.3
  user: app
  networkSecurityGroup:
    rules:
    - protocol: TCP
      port: 22
    - protocol: TCP
      port: 8080
    - protocol: TCP
      port: 80
      port: 9000
loadBalancer:
  loadBalancerMethod: ROUNDROBIN
  loadBalancerRules:
  - name: db-lb
    healthCheckPath: "GET /test"
    frontendRule:
      protocol: HTTP
      port: 80
    backendRule:
      protocol: HTTP
      port: 8080
gslb:
  loadBalancerMethod: PROXIMITY
  fqdn:
    fqdnName: tekton.examples.java-app.dev.walmart.com
```
#### Clouds Section
The clouds section 



## Parameters

All operations take the common parameters. Operation specific parameters are separated into their relevant sections below by action name.

### Common

- `action`: The action to perform with Tekton. Valid options are (case insensitive, can be camelCase or snake_case)
  - `provision`: [Provisions](#provisioning) new VMs
  - `getAddresses`: Returns the [addresses or hostnames](#addresses) of VMs in the `addresses` variable, to be passed into other flows, such as deployment
  - `replace`: [Replaces](#replace) existing VMs with new VMs
  - `destroy`: [Destroys](#destroy) a given environment completely
  - `getKeypair` Gets the SSH [keypair](#keypair) generated by Tekton for administrative actions (eg. application deployment)
  - `reboot`: [Reboots](#reboot) VMs
  - `getInventory`: Returns the Tekton [inventory](#inventory) for a given environment,
  - `getCert`: Gets the [certificate](#certificate) for a given FQDN
- `apiToken`: The Tekton API token to call tekton with. A default one is provided, and users should normally not set this unless specifically asked or requested.
- `apiUrl`: The URL of the Tekton instance you will be calling. A default one is provided, and users should normally not set this unless specifically asked or requested.
- `envName`: The environment name to use with tekton (eg. dev, prod, qa, stg, etc)

### Provision
- `templatePath`: Defaults to `compute.yml`. This is the location of your [compute template](#templates)

### GetAddresses
There are no specific parameters for getAddresses.

### Replace
- `targets`: A list (comma separated) of clouds and/or IP addresses to replace.

### Destroy
There are no specific parameters for destroy

### GetKeypair
There are no specific parameters for getKeypair

###Reboot
- `targets`: A list (comma separated) of clouds and/or IP addresses to replace

### GetInventory
There are no specific parameters for getInventory

### GetCert
- `fqdn`: The FQDN who's cert we're getting
- `teamDL`: The DL of the team this cert belongs to
- `keyPassword`: The password for the certificate key
- `format`: The certificate format
